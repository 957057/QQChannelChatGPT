import{v as m,o as e,c as u,w as a,b as s,B as d,C as T,e as _,D as p,a5 as w,n,l as r,f,g as o,t as l,K as y}from"./index-d089162b.js";import{_ as S}from"./_plugin-vue_export-helper-c27b6911.js";const k={name:"WaitingForRestart",data(){return{visible:!1,startTime:-1,newStartTime:-1,status:"",cnt:0}},methods:{async check(){this.newStartTime=-1,this.startTime=-1,this.visible=!0,this.status="",console.log("start wfr"),await this.getStartTime(),setTimeout(()=>{this.timeoutInternal()},1e3)},timeoutInternal(){console.log("wfr: timeoutInternal",this.newStartTime,this.startTime),this.newStartTime===-1&&this.cnt<15&&this.visible?(this.checkStartTime(),this.cnt++,setTimeout(()=>{this.timeoutInternal()},1e3)):(this.cnt==10&&(this.status="拉取状态达到最大次数，请手动检查。"),this.cnt=0,setTimeout(()=>{this.visible=!1},1e3))},async getStartTime(){m.get("/api/stat/start-time",{timeout:3e3}).then(i=>{this.startTime=i.data.data.start_time})},async checkStartTime(){let i=await m.get("/api/stat/start-time",{timeout:3e3});return this.newStartTime=i.data.data.start_time,console.log("wfr: checkStartTime",this.newStartTime,this.startTime),this.newStartTime!==this.startTime&&(console.log("wfr: restarted"),setTimeout(()=>{this.visible=!1,window.location.reload()},2e3)),this.newStartTime}}},g={style:{"margin-top":"16px"}},b={key:0,class:"py-12 text-center"},V=n("p",null,"重启成功！",-1),v={key:1,style:{display:"block"}},x={key:2,style:{display:"block"}},B={key:3,style:{display:"block"}},C={style:{display:"block"}};function I(i,c,N,D,t,W){return e(),u(y,{modelValue:t.visible,"onUpdate:modelValue":c[0]||(c[0]=h=>t.visible=h),persistent:"","max-width":"400"},{default:a(()=>[s(d,null,{default:a(()=>[s(T,null,{default:a(()=>[_("正在等待 AstrBot 重启...")]),_:1}),s(p,null,{default:a(()=>[s(w,{indeterminate:"",color:"primary"}),n("div",g,[t.newStartTime!=-1?(e(),r("div",b,[s(f,{class:"mb-6",color:"success",icon:"mdi-check-circle-outline",size:"128"}),V])):o("",!0),t.startTime!=-1?(e(),r("small",v,"当前实例标识："+l(t.startTime),1)):o("",!0),t.newStartTime!=-1?(e(),r("small",x,"检查到新实例："+l(t.newStartTime)+"，即将自动刷新页面",1)):o("",!0),t.status?(e(),r("small",B,l(t.status),1)):o("",!0),n("small",C,"次数："+l(t.cnt)+" / 15",1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const z=S(k,[["render",I]]);export{z as W};
