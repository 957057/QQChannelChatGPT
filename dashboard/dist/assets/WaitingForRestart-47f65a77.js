import{q as c,o as e,c as u,w as a,b as s,B as T,C as d,e as _,D as p,a5 as w,n as l,l as r,f,g as o,t as n,K as S}from"./index-59964cc6.js";import{_ as g}from"./_plugin-vue_export-helper-c27b6911.js";const V={name:"WaitingForRestart",data(){return{visible:!1,startTime:-1,newStartTime:-1,status:"",cnt:0}},methods:{async check(){this.newStartTime=-1,this.startTime=-1,this.visible=!0,this.status="",console.log("start wfr"),await this.getStartTime(),setTimeout(()=>{this.timeoutInternal()},1e3)},timeoutInternal(){console.log("wfr: timeoutInternal",this.newStartTime,this.startTime),this.newStartTime===-1&&this.cnt<10&&this.visible?(this.checkStartTime(),this.cnt++,setTimeout(()=>{this.timeoutInternal()},1e3)):(this.cnt==10&&(this.status="拉取状态达到最大次数，请手动检查。"),this.cnt=0,setTimeout(()=>{this.visible=!1},1e3))},async getStartTime(){c.get("/api/stat/start-time",{timeout:3e3}).then(i=>{this.startTime=i.data.data.start_time})},async checkStartTime(){let i=await c.get("/api/stat/start-time",{timeout:3e3});return this.newStartTime=i.data.data.start_time,console.log("wfr: checkStartTime",this.newStartTime,this.startTime),this.newStartTime!==this.startTime&&(console.log("wfr: restarted"),setTimeout(()=>{this.visible=!1,window.location.reload()},2e3)),this.newStartTime}}},k={style:{"margin-top":"16px"}},y={key:0,class:"py-12 text-center"},x=l("p",null,"重启成功！",-1),b={key:1},v={key:2},B={key:3};function C(i,m,I,N,t,D){return e(),u(S,{modelValue:t.visible,"onUpdate:modelValue":m[0]||(m[0]=h=>t.visible=h),persistent:"","max-width":"400"},{default:a(()=>[s(T,null,{default:a(()=>[s(d,null,{default:a(()=>[_("正在等待 AstrBot 重启...")]),_:1}),s(p,null,{default:a(()=>[s(w,{indeterminate:"",color:"primary"}),l("div",k,[t.newStartTime!=-1?(e(),r("div",y,[s(f,{class:"mb-6",color:"success",icon:"mdi-check-circle-outline",size:"128"}),x])):o("",!0),t.startTime!=-1?(e(),r("p",b,"当前实例标识："+n(t.startTime),1)):o("",!0),t.newStartTime!=-1?(e(),r("p",v,"检查到新实例："+n(t.newStartTime)+"，即将自动刷新页面",1)):o("",!0),t.status?(e(),r("p",B,n(t.status),1)):o("",!0),l("p",null,"次数："+n(t.cnt),1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const R=g(V,[["render",C]]);export{R as W};
