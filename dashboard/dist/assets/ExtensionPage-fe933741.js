import{k as A,o as i,c as r,w as e,b as a,n as d,C as V,e as u,t as p,z as k,y as g,Y as z,G as R,Z as U,D as y,B as C,l as c,_ as j,$ as G,F as f,r as x,a0 as H,H as M,a1 as q,V as N,A as B,g as v,L as b,K as w,a2 as O,q as m,a3 as W,M as _,E as $,J as E,a4 as Z,f as D,a5 as J}from"./index-3360c831.js";import{W as P}from"./WaitingForRestart-dd7c3e40.js";import"./_plugin-vue_export-helper-c27b6911.js";const K={class:"d-sm-flex align-center justify-space-between"},L=A({__name:"ExtensionCard",props:{title:String,link:String},setup(n){const t=n,o=l=>{window.open(l,"_blank")};return(l,s)=>(i(),r(C,{variant:"outlined",elevation:"0",class:"withbg"},{default:e(()=>[a(z,{style:{padding:"10px 14px"}},{default:e(()=>[d("div",K,[a(V,{style:{"font-size":"17px"}},{default:e(()=>[u(p(t.title),1)]),_:1}),a(k),a(g,{variant:"plain",onClick:s[0]||(s[0]=h=>o(t.link))},{default:e(()=>[u("仓库")]),_:1})])]),_:1}),a(R),a(y,null,{default:e(()=>[U(l.$slots,"default")]),_:3})]),_:3}))}}),Y={class:"d-sm-flex align-center justify-space-between"},Q=A({__name:"UiParentCard",props:{title:String},setup(n){const t=n;return(o,l)=>(i(),r(C,{variant:"outlined",elevation:"0",class:"withbg"},{default:e(()=>[a(z,null,{default:e(()=>[d("div",Y,[a(V,null,{default:e(()=>[u(p(t.title),1)]),_:1}),U(o.$slots,"action")])]),_:3}),a(R),a(y,null,{default:e(()=>[U(o.$slots,"default")]),_:3})]),_:3}))}}),F={__name:"ConfigDetailCard",props:{config:Array},setup(n){return(t,o)=>(i(),c(f,null,[j(d("a",null,"该插件没有配置",512),[[G,n.config.length===0]]),(i(!0),c(f,null,x(n.config,l=>(i(),r(Q,{key:l.name,title:l.name,style:{"margin-bottom":"16px"}},{default:e(()=>[(i(!0),c(f,null,x(l.body,s=>(i(),c(f,null,[s.config_type==="item"?(i(),c(f,{key:0},[s.val_type==="bool"?(i(),r(H,{key:0,modelValue:s.value,"onUpdate:modelValue":h=>s.value=h,label:s.name,hint:s.description,color:"primary",inset:""},null,8,["modelValue","onUpdate:modelValue","label","hint"])):s.val_type==="str"?(i(),r(M,{key:1,modelValue:s.value,"onUpdate:modelValue":h=>s.value=h,label:s.name,hint:s.description,style:{"margin-bottom":"8px"},variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","label","hint"])):s.val_type==="int"?(i(),r(M,{key:2,modelValue:s.value,"onUpdate:modelValue":h=>s.value=h,label:s.name,hint:s.description,style:{"margin-bottom":"8px"},variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","label","hint"])):s.val_type==="list"?(i(),c(f,{key:3},[d("span",null,p(s.name),1),a(q,{modelValue:s.value,"onUpdate:modelValue":h=>s.value=h,chips:"",clearable:"",label:"请添加",multiple:"","prepend-icon":"mdi-tag-multiple-outline"},{selection:e(({attrs:h,item:S,select:I,selected:T})=>[a(N,B(h,{"model-value":T,closable:"",onClick:I,"onClick:close":mt=>t.remove(S)}),{default:e(()=>[d("strong",null,p(S),1)]),_:2},1040,["model-value","onClick","onClick:close"])]),_:2},1032,["modelValue","onUpdate:modelValue"])],64)):v("",!0)],64)):s.config_type==="divider"?(i(),r(R,{key:1,style:{"margin-top":"8px","margin-bottom":"8px"}})):v("",!0)],64))),256))]),_:2},1032,["title"]))),128))],64))}},X=d("div",{style:{"background-color":"white",width:"100%",padding:"16px","border-radius":"10px"}},[d("h3",null,"🧩 已安装的插件")],-1),tt={style:{"min-height":"150px","max-height":"150px",overflow:"hidden"}},at={class:"d-flex align-center gap-2"},et=d("div",{style:{"background-color":"white",width:"100%",padding:"16px","border-radius":"10px"}},[d("h3",null,"🧩 插件市场")],-1),lt={style:{"min-height":"150px","max-height":"150px",overflow:"hidden"}},nt={class:"d-flex align-center gap-2"},ot=d("span",{class:"text-h5"},"插件配置",-1),st=d("span",{class:"text-h5"},"安装插件",-1),it=d("h3",null,"从 GitHub 上在线下载",-1),dt=d("small",null,"请输入合法的 GitHub 仓库链接，当前仅支持 GitHub。如：https://github.com/Soulter/astrbot_plugin_aiocqhttp",-1),ut=d("h3",null,"从本机上传 .zip 压缩包",-1),rt=d("small",null,"请保证插件文件存在压缩包根目录中的第一个文件夹中（即类似于从 GitHub 仓库页上下载的 Zip 压缩包的格式）。",-1),gt=d("br",null,null,-1),pt={class:"text-h5"},ht={key:0,class:"py-12 text-center"},ct={class:"text-h4 font-weight-bold"},ft={name:"ExtensionPage",components:{ExtensionCard:L,ConfigDetailCard:F,WaitingForRestart:P},data(){return{extension_data:{data:[]},extension_url:"",status:"",dialog:!1,snack_message:"",snack_show:!1,snack_success:"success",loading_:!1,configDialog:!1,extension_config:{},upload_file:null,pluginMarketData:{},loadingDialog:{show:!1,title:"加载中...",statusCode:0,statusMessage:"",result:""}}},mounted(){this.getExtensions(),this.fetchPluginCollection()},methods:{toast(n,t){this.snack_message=n,this.snack_show=!0,this.snack_success=t},onLoadingDialogResult(n,t,o=2e3){this.loadingDialog.statusCode=n,this.loadingDialog.result=t,setTimeout(()=>{this.loadingDialog={show:!1,title:"加载中...",statusCode:0,statusMessage:"",result:""}},o)},getExtensions(){m.get("/api/plugin/get").then(n=>{this.extension_data.data=n.data.data,this.checkAlreadyInstalled()})},newExtension(){if(this.extension_url===""&&this.upload_file===null){this.toast("请填写插件链接或上传插件文件","error");return}if(this.extension_url!==""&&this.upload_file!==null){this.toast("请不要同时填写插件链接和上传插件文件","error");return}if(this.loading_=!0,this.loadingDialog.show=!0,this.upload_file!==null){this.toast("正在从文件安装插件","primary");const n=new FormData;n.append("file",this.upload_file[0]),m.post("/api/plugin/install-upload",n,{headers:{"Content-Type":"multipart/form-data"}}).then(t=>{if(this.loading_=!1,t.data.status==="error"){this.onLoadingDialogResult(2,t.data.message);return}this.extension_data.data=t.data.data,this.upload_file="",this.onLoadingDialogResult(1,t.data.message),this.dialog=!1,this.$refs.wfr.check()}).catch(t=>{this.loading_=!1,this.onLoadingDialogResult(2,t)});return}else this.toast("正在从链接 "+this.extension_url+" 安装插件...","primary"),m.post("/api/plugin/install",{url:this.extension_url}).then(n=>{if(this.loading_=!1,n.data.status==="error"){this.onLoadingDialogResult(2,n.data.message);return}this.extension_data.data=n.data.data,console.log(this.extension_data),this.extension_url="",this.onLoadingDialogResult(1,n.data.message),this.dialog=!1,this.$refs.wfr.check()}).catch(n=>{this.loading_=!1,this.onLoadingDialogResult(2,n)})},uninstallExtension(n){this.toast("正在卸载"+n,"primary"),m.post("/api/plugin/uninstall",{name:n}).then(t=>{if(t.data.status==="error"){this.toast(t.data.message,"error");return}this.extension_data.data=t.data.data,this.toast(t.data.message,"success"),this.dialog=!1,this.getExtensions()}).catch(t=>{this.toast(t,"error")})},updateExtension(n){this.loadingDialog.show=!0,m.post("/api/plugin/update",{name:n}).then(t=>{if(t.data.status==="error"){this.onLoadingDialogResult(2,t.data.message);return}this.extension_data.data=t.data.data,console.log(this.extension_data),this.onLoadingDialogResult(1,t.data.message),this.dialog=!1,this.$refs.wfr.check()}).catch(t=>{this.toast(t,"error")})},openExtensionConfig(n){this.curr_namespace=n,this.configDialog=!0,m.get("/api/config/get?namespace="+n).then(t=>{this.extension_config=t.data.data,console.log(this.extension_config)}).catch(t=>{this.toast(t,"error")})},updateConfig(){m.post("/api/config/plugin/update",{config:this.extension_config,namespace:this.curr_namespace}).then(n=>{n.data.status==="ok"?(this.toast(n.data.message,"success"),this.$refs.wfr.check()):this.toast(n.data.message,"error")}).catch(n=>{this.toast(n,"error")})},fetchPluginCollection(){let n="https://soulter.github.io/AstrBot_Plugins_Collection/plugins.json";m.get(n).then(t=>{let o=[];this.pluginMarketDataOrigin=t.data;for(let l in t.data)o.push({name:l,desc:t.data[l].desc,author:t.data[l].author,repo:t.data[l].repo,installed:!1});this.pluginMarketData=o,this.checkAlreadyInstalled()}).catch(t=>{this.toast("获取插件市场数据失败: "+t,"error")})},checkAlreadyInstalled(){for(let n=0;n<this.pluginMarketData.length;n++)this.pluginMarketData[n].installed=!1;for(let n=0;n<this.pluginMarketData.length;n++)for(let t=0;t<this.extension_data.data.length;t++)this.pluginMarketData[n].repo===this.extension_data.data[t].repo&&(this.pluginMarketData[n].installed=!0)}}},Vt=Object.assign(ft,{setup(n){return(t,o)=>(i(),c(f,null,[a(b,null,{default:e(()=>[a(W,{style:{margin:"16px"},text:"1. 如果因为网络问题安装失败，可以前往 配置->其他配置->插件仓库镜像 修改安装镜像源。2. 如需插件帮助请点击 `仓库` 查看 README",title:"💡小提示",type:"info",variant:"tonal"}),a(_,{cols:"12",md:"12"},{default:e(()=>[X]),_:1}),(i(!0),c(f,null,x(t.extension_data.data,l=>(i(),r(_,{cols:"12",md:"6",lg:"4"},{default:e(()=>[(i(),r(L,{key:l.name,title:l.name,link:l.repo,style:{"margin-bottom":"4px"}},{default:e(()=>[d("p",tt,p(l.desc),1),d("div",at,[a(D,null,{default:e(()=>[u("mdi-account")]),_:1}),d("span",null,p(l.author),1),a(k),a(g,{variant:"plain",onClick:s=>t.openExtensionConfig(l.name)},{default:e(()=>[u("配置")]),_:2},1032,["onClick"]),a(g,{variant:"plain",onClick:s=>t.updateExtension(l.name)},{default:e(()=>[u("更新")]),_:2},1032,["onClick"]),a(g,{variant:"plain",onClick:s=>t.uninstallExtension(l.name)},{default:e(()=>[u("卸载")]),_:2},1032,["onClick"])])]),_:2},1032,["title","link"]))]),_:2},1024))),256)),a(_,{cols:"12",md:"12"},{default:e(()=>[et]),_:1}),(i(!0),c(f,null,x(t.pluginMarketData,l=>(i(),r(_,{cols:"12",md:"6",lg:"4"},{default:e(()=>[(i(),r(L,{key:l.name,title:l.name,link:l.repo,style:{"margin-bottom":"4px"}},{default:e(()=>[d("p",lt,p(l.desc),1),d("div",nt,[a(D,null,{default:e(()=>[u("mdi-account")]),_:1}),d("span",null,p(l.author),1),a(k),l.installed?(i(),r(g,{key:1,variant:"plain",disabled:""},{default:e(()=>[u("已安装")]),_:1})):(i(),r(g,{key:0,variant:"plain",onClick:s=>{t.extension_url=l.repo,t.newExtension()}},{default:e(()=>[u("安装")]),_:2},1032,["onClick"]))])]),_:2},1032,["title","link"]))]),_:2},1024))),256))]),_:1}),a(w,{modelValue:t.configDialog,"onUpdate:modelValue":o[1]||(o[1]=l=>t.configDialog=l),width:"750"},{activator:e(({props:l})=>[]),default:e(()=>[a(C,null,{default:e(()=>[a(V,null,{default:e(()=>[ot]),_:1}),a(y,null,{default:e(()=>[a($,null,{default:e(()=>[a(F,{config:t.extension_config},null,8,["config"])]),_:1})]),_:1}),a(E,null,{default:e(()=>[a(k),a(g,{color:"blue-darken-1",variant:"text",onClick:t.updateConfig},{default:e(()=>[u(" 保存并关闭 ")]),_:1},8,["onClick"]),a(g,{color:"blue-darken-1",variant:"text",onClick:o[0]||(o[0]=l=>t.configDialog=!1)},{default:e(()=>[u(" 关闭 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(w,{modelValue:t.dialog,"onUpdate:modelValue":o[6]||(o[6]=l=>t.dialog=l),persistent:"",width:"700"},{activator:e(({props:l})=>[a(g,B(l,{icon:"mdi-plus",size:"x-large",style:{position:"fixed",right:"52px",bottom:"52px"},color:"darkprimary"}),null,16)]),default:e(()=>[a(C,null,{default:e(()=>[a(V,null,{default:e(()=>[st]),_:1}),a(y,null,{default:e(()=>[a($,null,{default:e(()=>[a(b,null,{default:e(()=>[it,a(_,{cols:"12"},{default:e(()=>[dt,a(M,{label:"仓库链接",modelValue:t.extension_url,"onUpdate:modelValue":o[2]||(o[2]=l=>t.extension_url=l),variant:"outlined",required:""},null,8,["modelValue"])]),_:1})]),_:1}),a(b,null,{default:e(()=>[ut,a(_,{cols:"12"},{default:e(()=>[rt,a(Z,{label:"选择文件",modelValue:t.upload_file,"onUpdate:modelValue":o[3]||(o[3]=l=>t.upload_file=l),accept:".zip",outlined:"",required:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),gt,d("small",null,p(t.status),1)]),_:1}),a(E,null,{default:e(()=>[a(k),a(g,{color:"blue-darken-1",variant:"text",onClick:o[4]||(o[4]=l=>t.dialog=!1)},{default:e(()=>[u(" 关闭 ")]),_:1}),a(g,{color:"blue-darken-1",variant:"text",loading:t.loading_,onClick:o[5]||(o[5]=l=>t.newExtension())},{default:e(()=>[u(" 安装 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(w,{modelValue:t.loadingDialog.show,"onUpdate:modelValue":o[8]||(o[8]=l=>t.loadingDialog.show=l),width:"500",persistent:""},{default:e(()=>[a(C,null,{default:e(()=>[a(V,null,{default:e(()=>[d("span",pt,p(t.loadingDialog.title),1)]),_:1}),a(y,null,{default:e(()=>[a($,null,{default:e(()=>[a(b,null,{default:e(()=>[a(_,{cols:"12"},{default:e(()=>[t.loadingDialog.statusCode===0?(i(),r(J,{key:0,indeterminate:"",color:"primary"})):v("",!0)]),_:1})]),_:1}),t.loadingDialog.statusCode!==0?(i(),c("div",ht,[t.loadingDialog.statusCode===1?(i(),r(D,{key:0,class:"mb-6",color:"success",icon:"mdi-check-circle-outline",size:"128"})):v("",!0),t.loadingDialog.statusCode===2?(i(),r(D,{key:1,class:"mb-6",color:"error",icon:"mdi-alert-circle-outline",size:"128"})):v("",!0),d("div",ct,p(t.loadingDialog.result),1)])):v("",!0)]),_:1})]),_:1}),a(E,null,{default:e(()=>[a(k),a(g,{color:"blue-darken-1",variant:"text",onClick:o[7]||(o[7]=l=>t.loadingDialog.show=!1)},{default:e(()=>[u(" 关闭 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(O,{timeout:2e3,elevation:"24",color:t.snack_success,modelValue:t.snack_show,"onUpdate:modelValue":o[9]||(o[9]=l=>t.snack_show=l)},{default:e(()=>[u(p(t.snack_message),1)]),_:1},8,["color","modelValue"]),a(P,{ref:"wfr"},null,512)],64))}});export{Vt as default};
