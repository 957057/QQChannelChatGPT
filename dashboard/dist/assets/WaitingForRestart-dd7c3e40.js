import{q as m,o as e,c as u,w as a,b as s,B as d,C as T,e as _,D as p,a5 as f,n as l,l as r,f as w,g as n,t as o,K as S}from"./index-3360c831.js";import{_ as g}from"./_plugin-vue_export-helper-c27b6911.js";const v={name:"WaitingForRestart",data(){return{visible:!1,startTime:-1,newStartTime:-1,status:"",cnt:0,intervalId:null}},methods:{async check(){this.newStartTime=-1,this.startTime=-1,this.visible=!0,this.status="",console.log("start wfr"),await this.getStartTime(),this.intervalId=setInterval(()=>{if(this.newStartTime===-1&&this.cnt<10&&this.visible)this.checkStartTime(),this.cnt++;else{this.cnt==10&&(this.status="拉取状态达到最大次数，请手动检查。"),this.cnt=0,setTimeout(()=>{this.visible=!1},1e3),clearInterval(this.intervalId);return}},1e3)},async getStartTime(){m.get("/api/stat/start-time").then(i=>{this.startTime=i.data.data.start_time})},async checkStartTime(){let i=await m.get("/api/stat/start-time");this.newStartTime=i.data.data.start_time,console.log("wfr: checkStartTime",this.newStartTime,this.startTime),this.newStartTime!==this.startTime&&(console.log("wfr: restarted"),setTimeout(()=>{this.visible=!1,window.location.reload()},2e3))}}},V={style:{"margin-top":"16px"}},k={key:0,class:"py-12 text-center"},y=l("p",null,"重启成功！",-1),x={key:1},b={key:2},B={key:3};function C(i,c,I,N,t,D){return e(),u(S,{modelValue:t.visible,"onUpdate:modelValue":c[0]||(c[0]=h=>t.visible=h),persistent:"","max-width":"400"},{default:a(()=>[s(d,null,{default:a(()=>[s(T,null,{default:a(()=>[_("正在等待 AstrBot 重启...")]),_:1}),s(p,null,{default:a(()=>[s(f,{indeterminate:"",color:"primary"}),l("div",V,[t.newStartTime!=-1?(e(),r("div",k,[s(w,{class:"mb-6",color:"success",icon:"mdi-check-circle-outline",size:"128"}),y])):n("",!0),t.startTime!=-1?(e(),r("p",x,"当前实例标识："+o(t.startTime),1)):n("",!0),t.newStartTime!=-1?(e(),r("p",b,"检查到新实例："+o(t.newStartTime)+"，即将自动刷新页面",1)):n("",!0),t.status?(e(),r("p",B,o(t.status),1)):n("",!0),l("p",null,"次数："+o(t.cnt),1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const R=g(v,[["render",C]]);export{R as W};
