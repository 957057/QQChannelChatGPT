import{q as P,o as d,c as r,w as a,d as e,u as i,H as v,a as u,t as c,E as k,D as p,_ as B,A as E,$ as y,I as V,G as x,l as g,a0 as H,a1 as N,F as f,n as b,a2 as T,K as w,a3 as q,e as O,m as j,g as U,O as C,N as S,a4 as J,z as _,P as m,J as M,M as A,a5 as K,f as I}from"./index-b50bcc8e.js";const L={class:"d-sm-flex align-center justify-space-between"},D=P({__name:"ExtensionCard",props:{title:String,link:String},setup(n){const t=n,o=l=>{window.open(l,"_blank")};return(l,s)=>(d(),r(x,{variant:"outlined",elevation:"0",class:"withbg"},{default:a(()=>[e(B,{style:{padding:"10px 14px"}},{default:a(()=>[i("div",L,[e(v,{style:{"font-size":"17px"}},{default:a(()=>[u(c(t.title),1)]),_:1}),e(k),e(p,{variant:"plain",onClick:s[0]||(s[0]=h=>o(t.link))},{default:a(()=>[u("仓库")]),_:1})])]),_:1}),e(E),e(V,null,{default:a(()=>[y(l.$slots,"default")]),_:3})]),_:3}))}}),R={class:"d-sm-flex align-center justify-space-between"},Z=P({__name:"UiParentCard",props:{title:String},setup(n){const t=n;return(o,l)=>(d(),r(x,{variant:"outlined",elevation:"0",class:"withbg"},{default:a(()=>[e(B,null,{default:a(()=>[i("div",R,[e(v,null,{default:a(()=>[u(c(t.title),1)]),_:1}),y(o.$slots,"action")])]),_:3}),e(E),e(V,null,{default:a(()=>[y(o.$slots,"default")]),_:3})]),_:3}))}}),z={__name:"ConfigDetailCard",props:{config:Array},setup(n){return(t,o)=>(d(),g(f,null,[H(i("a",null,"该插件没有配置",512),[[N,n.config.length===0]]),(d(!0),g(f,null,b(n.config,l=>(d(),r(Z,{key:l.name,title:l.name,style:{"margin-bottom":"16px"}},{default:a(()=>[(d(!0),g(f,null,b(l.body,s=>(d(),g(f,null,[s.config_type==="item"?(d(),g(f,{key:0},[s.val_type==="bool"?(d(),r(T,{key:0,modelValue:s.value,"onUpdate:modelValue":h=>s.value=h,label:s.name,hint:s.description,color:"primary",inset:""},null,8,["modelValue","onUpdate:modelValue","label","hint"])):s.val_type==="str"?(d(),r(w,{key:1,modelValue:s.value,"onUpdate:modelValue":h=>s.value=h,label:s.name,hint:s.description,style:{"margin-bottom":"8px"},variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","label","hint"])):s.val_type==="int"?(d(),r(w,{key:2,modelValue:s.value,"onUpdate:modelValue":h=>s.value=h,label:s.name,hint:s.description,style:{"margin-bottom":"8px"},variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","label","hint"])):s.val_type==="list"?(d(),g(f,{key:3},[i("span",null,c(s.name),1),e(q,{modelValue:s.value,"onUpdate:modelValue":h=>s.value=h,chips:"",clearable:"",label:"请添加",multiple:"","prepend-icon":"mdi-tag-multiple-outline"},{selection:a(({attrs:h,item:$,select:F,selected:G})=>[e(O,j(h,{"model-value":G,closable:"",onClick:F,"onClick:close":rt=>t.remove($)}),{default:a(()=>[i("strong",null,c($),1)]),_:2},1040,["model-value","onClick","onClick:close"])]),_:2},1032,["modelValue","onUpdate:modelValue"])],64)):U("",!0)],64)):s.config_type==="divider"?(d(),r(E,{key:1,style:{"margin-top":"8px","margin-bottom":"8px"}})):U("",!0)],64))),256))]),_:2},1032,["title"]))),128))],64))}},Q=i("div",{style:{"background-color":"white",width:"100%",padding:"16px","border-radius":"10px"}},[i("h3",null,"🧩 已安装的插件")],-1),W={style:{"min-height":"150px","max-height":"150px",overflow:"hidden"}},X={class:"d-flex align-center gap-2"},Y=i("div",{style:{"background-color":"white",width:"100%",padding:"16px","border-radius":"10px"}},[i("h3",null,"🧩 插件市场")],-1),tt={style:{"min-height":"150px","max-height":"150px",overflow:"hidden"}},at={class:"d-flex align-center gap-2"},et=i("span",{class:"text-h5"},"插件配置",-1),lt=i("span",{class:"text-h5"},"安装插件",-1),nt=i("h3",null,"从 GitHub 上在线下载",-1),st=i("small",null,"请输入合法的 GitHub 仓库链接，当前仅支持 GitHub。如：https://github.com/Soulter/astrbot_plugin_aiocqhttp",-1),ot=i("h3",null,"从本机上传 .zip 压缩包",-1),it=i("small",null,"请保证插件文件存在压缩包根目录中的第一个文件夹中（即类似于从 GitHub 仓库页上下载的 Zip 压缩包的格式）。",-1),dt=i("br",null,null,-1),ut={name:"ExtensionPage",components:{ExtensionCard:D,ConfigDetailCard:z},data(){return{extension_data:{data:[]},extension_url:"",status:"",dialog:!1,snack_message:"",snack_show:!1,snack_success:"success",loading_:!1,configDialog:!1,extension_config:{},upload_file:null,pluginMarketData:{}}},mounted(){this.getExtensions(),this.fetchPluginCollection()},methods:{toast(n,t){this.snack_message=n,this.snack_show=!0,this.snack_success=t},getExtensions(){_.get("/api/plugin/get").then(n=>{this.extension_data.data=n.data.data,this.checkAlreadyInstalled()})},newExtension(){if(this.extension_url===""&&this.upload_file===null){this.toast("请填写插件链接或上传插件文件","error");return}if(this.extension_url!==""&&this.upload_file!==null){this.toast("请不要同时填写插件链接和上传插件文件","error");return}if(this.loading_=!0,this.upload_file!==null){const n=new FormData;n.append("file",this.upload_file[0]),_.post("/api/plugin/install-upload",n,{headers:{"Content-Type":"multipart/form-data"}}).then(t=>{if(this.loading_=!1,t.data.status==="error"){this.toast(t.data.message,"error");return}this.extension_data.data=t.data.data,console.log(this.extension_data),this.upload_file="",this.toast(t.data.message,"success"),this.dialog=!1,this.getExtensions()}).catch(t=>{this.loading_=!1,this.toast(t,"error")});return}else _.post("/api/plugin/install",{url:this.extension_url}).then(n=>{if(this.loading_=!1,n.data.status==="error"){this.toast(n.data.message,"error");return}this.extension_data.data=n.data.data,console.log(this.extension_data),this.extension_url="",this.toast(n.data.message,"success"),this.dialog=!1,this.getExtensions()}).catch(n=>{this.loading_=!1,this.toast(n,"error")})},uninstallExtension(n){this.loading_=!0,_.post("/api/plugin/uninstall",{name:n}).then(t=>{if(this.loading_=!1,t.data.status==="error"){this.toast(t.data.message,"error");return}this.extension_data.data=t.data.data,console.log(this.extension_data),this.toast(t.data.message,"success"),this.dialog=!1,this.getExtensions()}).catch(t=>{this.loading_=!1,this.toast(t,"error")})},updateExtension(n){this.loading_=!0,_.post("/api/plugin/update",{name:n}).then(t=>{if(this.loading_=!1,t.data.status==="error"){this.toast(t.data.message,"error");return}this.extension_data.data=t.data.data,console.log(this.extension_data),this.toast(t.data.message,"success"),this.dialog=!1,this.getExtensions()}).catch(t=>{this.loading_=!1,this.toast(t,"error")})},openExtensionConfig(n){this.curr_namespace=n,this.configDialog=!0,_.get("/api/config/get?namespace="+n).then(t=>{this.extension_config=t.data.data,console.log(this.extension_config)}).catch(t=>{this.toast(t,"error")})},updateConfig(){_.post("/api/plugin/update",{config:this.extension_config,namespace:this.curr_namespace}).then(n=>{n.data.status==="success"?this.toast(n.data.message,"success"):this.toast(n.data.message,"error")}).catch(n=>{this.toast(n,"error")})},fetchPluginCollection(){let n="https://soulter.github.io/AstrBot_Plugins_Collection/plugins.json";_.get(n).then(t=>{let o=[];this.pluginMarketDataOrigin=t.data;for(let l in t.data)o.push({name:l,desc:t.data[l].desc,author:t.data[l].author,repo:t.data[l].repo,installed:!1});this.pluginMarketData=o,this.checkAlreadyInstalled()}).catch(t=>{this.toast("获取插件市场数据失败: "+t,"error")})},checkAlreadyInstalled(){for(let n=0;n<this.pluginMarketData.length;n++)for(let t=0;t<this.extension_data.data.length;t++)this.pluginMarketData[n].repo===this.extension_data.data[t].repo&&(this.pluginMarketData[n].installed=!0)}}},ht=Object.assign(ut,{setup(n){return(t,o)=>(d(),g(f,null,[e(C,null,{default:a(()=>[e(m,{cols:"12",md:"12"},{default:a(()=>[Q]),_:1}),(d(!0),g(f,null,b(t.extension_data.data,l=>(d(),r(m,{cols:"12",md:"6",lg:"4"},{default:a(()=>[(d(),r(D,{key:l.name,title:l.name,link:l.repo,style:{"margin-bottom":"4px"}},{default:a(()=>[i("p",W,c(l.desc),1),i("div",X,[e(I,null,{default:a(()=>[u("mdi-account")]),_:1}),i("span",null,c(l.author),1),e(k),e(p,{variant:"plain",onClick:s=>t.openExtensionConfig(l.name)},{default:a(()=>[u("配置")]),_:2},1032,["onClick"]),e(p,{variant:"plain",onClick:s=>t.updateExtension(l.name),loading:t.loading_},{default:a(()=>[u("更新")]),_:2},1032,["onClick","loading"]),e(p,{variant:"plain",onClick:s=>t.uninstallExtension(l.name),loading:t.loading_},{default:a(()=>[u("卸载")]),_:2},1032,["onClick","loading"])])]),_:2},1032,["title","link"]))]),_:2},1024))),256)),e(m,{cols:"12",md:"12"},{default:a(()=>[Y]),_:1}),(d(!0),g(f,null,b(t.pluginMarketData,l=>(d(),r(m,{cols:"12",md:"6",lg:"4"},{default:a(()=>[(d(),r(D,{key:l.name,title:l.name,link:l.repo,style:{"margin-bottom":"4px"}},{default:a(()=>[i("p",tt,c(l.desc),1),i("div",at,[e(I,null,{default:a(()=>[u("mdi-account")]),_:1}),i("span",null,c(l.author),1),e(k),l.installed?(d(),r(p,{key:1,variant:"plain",disabled:""},{default:a(()=>[u("已安装")]),_:1})):(d(),r(p,{key:0,loading:t.loading_,variant:"plain",onClick:s=>{t.extension_url=l.repo,t.newExtension()}},{default:a(()=>[u("安装")]),_:2},1032,["loading","onClick"]))])]),_:2},1032,["title","link"]))]),_:2},1024))),256))]),_:1}),e(S,{modelValue:t.configDialog,"onUpdate:modelValue":o[1]||(o[1]=l=>t.configDialog=l),width:"750"},{activator:a(({props:l})=>[]),default:a(()=>[e(x,null,{default:a(()=>[e(v,null,{default:a(()=>[et]),_:1}),e(V,null,{default:a(()=>[e(M,null,{default:a(()=>[e(z,{config:t.extension_config},null,8,["config"])]),_:1})]),_:1}),e(A,null,{default:a(()=>[e(k),e(p,{color:"blue-darken-1",variant:"text",onClick:t.updateConfig},{default:a(()=>[u(" 保存并关闭 ")]),_:1},8,["onClick"]),e(p,{color:"blue-darken-1",variant:"text",onClick:o[0]||(o[0]=l=>t.configDialog=!1)},{default:a(()=>[u(" 关闭 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(S,{modelValue:t.dialog,"onUpdate:modelValue":o[6]||(o[6]=l=>t.dialog=l),persistent:"",width:"700"},{activator:a(({props:l})=>[e(p,j(l,{icon:"mdi-plus",size:"x-large",style:{position:"fixed",right:"52px",bottom:"52px"},color:"darkprimary"}),null,16)]),default:a(()=>[e(x,null,{default:a(()=>[e(v,null,{default:a(()=>[lt]),_:1}),e(V,null,{default:a(()=>[e(M,null,{default:a(()=>[e(C,null,{default:a(()=>[nt,e(m,{cols:"12"},{default:a(()=>[st,e(w,{label:"仓库链接",modelValue:t.extension_url,"onUpdate:modelValue":o[2]||(o[2]=l=>t.extension_url=l),variant:"outlined",required:""},null,8,["modelValue"])]),_:1})]),_:1}),e(C,null,{default:a(()=>[ot,e(m,{cols:"12"},{default:a(()=>[it,e(K,{label:"选择文件",modelValue:t.upload_file,"onUpdate:modelValue":o[3]||(o[3]=l=>t.upload_file=l),accept:".zip",outlined:"",required:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),dt,i("small",null,c(t.status),1)]),_:1}),e(A,null,{default:a(()=>[e(k),e(p,{color:"blue-darken-1",variant:"text",onClick:o[4]||(o[4]=l=>t.dialog=!1)},{default:a(()=>[u(" 关闭 ")]),_:1}),e(p,{color:"blue-darken-1",variant:"text",loading:t.loading_,onClick:o[5]||(o[5]=l=>t.newExtension())},{default:a(()=>[u(" 安装 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(J,{timeout:2e3,elevation:"24",color:t.snack_success,modelValue:t.snack_show,"onUpdate:modelValue":o[7]||(o[7]=l=>t.snack_show=l)},{default:a(()=>[u(c(t.snack_message),1)]),_:1},8,["color","modelValue"])],64))}});export{ht as default};
